# =============================================================================
# BASE IMAGE
# =============================================================================
FROM python:3.12-slim

# =============================================================================
# WORKING DIRECTORY
# =============================================================================
WORKDIR /app

# =============================================================================
# COPY REQUIREMENTS AND INSTALL DEPENDENCIES
# =============================================================================
COPY requirements.txt .

# Upgrade pip and install all dependencies globally (so non-root user can access them)
RUN pip install --upgrade pip \
    && pip install --no-cache-dir -r requirements.txt
RUN pip install google-adk==1.16.0
# =============================================================================
# CREATE NON-ROOT USER
# =============================================================================
RUN adduser --disabled-password --gecos "" myuser \
    && chown -R myuser:myuser /app

# =============================================================================
# COPY APPLICATION CODE
# =============================================================================
COPY . .

# =============================================================================
# SWITCH TO NON-ROOT USER
# =============================================================================
USER myuser

# =============================================================================
# ENVIRONMENT VARIABLES
# =============================================================================

ENV PATH="/home/myuser/.local/bin:$PATH"

# =============================================================================
# EXPOSE PORT
# =============================================================================
EXPOSE 8080

# =============================================================================
# START COMMAND
# =============================================================================
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8080"]
#CMD ["python", "main.py"]


